<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; color: #333; }
        
        /* Navbar - Adjusted for mobile text size */
        .navbar { 
            background: linear-gradient(to right, #8f94fb, #4e54c8); 
            padding: 15px; 
            color: white; 
            text-align: center; 
            font-size: 20px; 
            font-weight: bold; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }

        .container { padding: 15px; max-width: 1100px; margin: auto; }

        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        h3 { margin-top: 0; color: #333; border-bottom: 2px solid #f0f2f5; padding-bottom: 10px; font-size: 18px; }

        /* üîπ Responsive Input Group */
        .input-group { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        
        input { 
            flex: 1; 
            min-width: 100%; /* Force full width on mobile */
            padding: 12px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            outline: none; 
            font-size: 16px; /* Prevents iOS zoom-on-focus */
        }

        button { 
            width: 100%; /* Full width buttons on mobile */
            padding: 12px 25px; 
            border: none; 
            border-radius: 8px; 
            background: #4e54c8; 
            color: white; 
            cursor: pointer; 
            font-weight: 600; 
            transition: 0.3s; 
        }

        /* üîπ Table Responsiveness */
        .table-wrapper { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; min-width: 500px; } /* Ensures table doesn't get squashed */
        
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; font-size: 14px; }
        
        /* Status Badges */
        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; display: inline-block; white-space: nowrap; }
        .signed { background: #e6fffa; color: #2c7a7b; border: 1px solid #b2f5ea; }
        .disagreed { background: #fff5f5; color: #c53030; border: 1px solid #feb2b2; } 
        .pending { background: #fffaf0; color: #9c4221; border: 1px solid #fbd38d; }
        
        .btn-delete { background: #feb2b2; color: #9b2c2c; width: auto; padding: 6px 12px; font-size: 12px; }
        .logout-btn { background: #4a5568; margin-top: 20px; }

        /* üîπ MEDIA QUERIES for Desktop */
        @media (min-width: 768px) {
            .container { padding: 30px; }
            input { min-width: 200px; }
            button { width: auto; }
            h3 { font-size: 22px; }
            .navbar { font-size: 24px; }
        }

        .logo-header {
    position: absolute; /* Keeps it in the corner */
    top: 20px;
    left: 20px;
    background: white;
    padding: 10px 15px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    z-index: 1000; /* Ensures it stays above other elements */
    display: flex;
    align-items: center;
    justify-content: center;
}

.logo-header svg {
    width: 140px; /* Adjusted size for better fit */
    height: auto;
}

/* On mobile, make the logo slightly smaller */
@media (max-width: 600px) {
    .logo-header {
        top: 10px;
        left: 10px;
        padding: 8px 12px;
    }
    .logo-header svg {
        width: 110px;
    }
}
    </style>
</head>
<body>
    <div class="logo-header">
    <svg width="180" height="37" viewBox="0 0 180 37" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g>
            <path d="M0 15.2309V0.626219C0 0.275961 0.275278 0 0.624669 0H8.036C10.8841 0 13.1922 2.31383 13.1922 5.16896V15.2309C13.1922 15.5812 12.9169 15.8571 12.5675 15.8571H0.624669C0.275278 15.8571 0 15.5812 0 15.2309Z" fill="#B71530"/>
            <path d="M0 21.7693V36.374C0 36.7242 0.275278 37.0002 0.624669 37.0002H8.036C10.8841 37.0002 13.1922 34.6864 13.1922 31.8312V21.7693C13.1922 21.419 12.9169 21.1431 12.5675 21.1431H0.624669C0.275278 21.1431 0 21.419 0 21.7693Z" fill="#B71530"/>
            <path d="M31.7097 15.2309V0.626219C31.7097 0.275961 31.4345 0 31.0851 0H23.6737C20.8257 0 18.5176 2.31383 18.5176 5.16896V15.2309C18.5176 15.5812 18.7929 15.8571 19.1422 15.8571H31.0851C31.4345 15.8571 31.7097 15.5812 31.7097 15.2309Z" fill="#B71530"/>
            <path d="M31.7097 21.7693V36.374C31.7097 36.7242 31.4345 37.0002 31.0851 37.0002H23.6737C20.8257 37.0002 18.5176 34.6864 18.5176 31.8312V21.7693C13.1922 21.419 12.9169 21.1431 12.5675 21.1431H0.624669C0.275278 21.1431 0 21.419 0 21.7693Z" fill="#B71530"/>
            <path d="M48.1734 30.8544H44.1289V6.1665H48.1734V16.6424H58.1575V6.1665H62.202V30.8438H58.1575V20.3042H48.1734V30.8438V30.8544Z" fill="#022D5B"/>
            <path d="M67.8342 11.1762C67.1037 11.1762 66.4896 10.9427 65.992 10.4757C65.4838 10.0087 65.2402 9.38244 65.2402 8.60762C65.2402 7.83281 65.4943 7.20659 65.992 6.73958C66.5002 6.27257 67.1142 6.03906 67.8342 6.03906C68.5542 6.03906 69.2106 6.27257 69.6976 6.73958C70.1952 7.20659 70.4388 7.83281 70.4388 8.60762C70.4388 9.38244 70.1952 10.0087 69.6976 10.4757C69.2 10.9427 68.5859 11.1762 67.8342 11.1762ZM69.7717 30.8543H65.9073V13.4369H69.7717V30.8543Z" fill="#022D5B"/>
            <path d="M77.469 30.8543H73.6045V13.437H77.4054V15.9737H77.9984C78.3054 15.2732 78.8665 14.6257 79.6818 14.0313C80.497 13.4476 81.7358 13.1504 83.3769 13.1504C84.7109 13.1504 85.8967 13.4476 86.9131 14.0526C87.9295 14.6469 88.7342 15.4961 89.3059 16.5787C89.8777 17.6613 90.1635 18.9456 90.1635 20.4209V30.8543H86.299V20.7393C86.299 19.2852 85.9391 18.2026 85.2297 17.4915C84.5097 16.791 83.5145 16.4301 82.2228 16.4301C80.7723 16.4301 79.6183 16.9183 78.7607 17.8948C77.9031 18.8713 77.4796 20.2511 77.4796 22.0342V30.8437L77.469 30.8543Z" fill="#022D5B"/>
            <path d="M100.963 31.3426C99.534 31.3426 98.2106 30.9924 97.0036 30.3025C95.7966 29.6126 94.8226 28.5936 94.0814 27.2563C93.3403 25.9189 92.9697 24.3056 92.9697 22.427V21.8963C92.9697 20.0176 93.3297 18.4043 94.0602 17.067C94.7908 15.7296 95.7649 14.7001 96.9824 13.9995C98.2 13.299 99.5235 12.9382 100.953 12.9382C102.054 12.9382 102.986 13.0761 103.727 13.3415C104.478 13.6068 105.093 13.9571 105.569 14.3816C106.045 14.8062 106.405 15.2414 106.638 15.6872H107.242V6.1665H111.106V30.8438H107.305V28.4769H106.712C106.289 29.2092 105.643 29.8673 104.764 30.4511C103.886 31.0348 102.615 31.332 100.953 31.332L100.963 31.3426ZM102.096 27.9568C103.6 27.9568 104.838 27.4686 105.823 26.4921C106.808 25.5156 107.305 24.1252 107.305 22.3102V21.96C107.305 20.145 106.818 18.7652 105.844 17.7993C104.87 16.8335 103.621 16.3558 102.096 16.3558C100.572 16.3558 99.3541 16.8335 98.3694 17.7993C97.3848 18.7652 96.8871 20.145 96.8871 21.96V22.3102C96.8871 24.1252 97.3848 25.5156 98.3694 26.4921C99.3541 27.4686 100.593 27.9568 102.096 27.9568Z" fill="#022D5B"/>
            <path d="M118.793 30.8543H114.929V13.437H118.73V15.443H119.323C119.63 14.8274 120.148 14.2967 120.868 13.8403C121.599 13.3839 122.573 13.1504 123.791 13.1504C125.008 13.1504 126.077 13.4051 126.85 13.9252C127.623 14.4453 128.206 15.1033 128.608 15.8994H129.201C129.603 15.1246 130.175 14.4665 130.927 13.9464C131.678 13.4157 132.748 13.1504 134.124 13.1504C135.225 13.1504 136.22 13.3839 137.099 13.8403C137.978 14.2967 138.677 14.9866 139.196 15.8994C139.714 16.8122 139.968 17.9479 139.968 19.2852V30.8543H136.104V19.6036C136.104 18.5741 135.829 17.778 135.278 17.2261C134.728 16.6742 133.944 16.3982 132.938 16.3982C131.858 16.3982 131.001 16.7485 130.355 17.4596C129.709 18.1601 129.391 19.1897 129.391 20.527V30.8543H125.527V19.6036C125.527 18.5741 125.252 17.778 124.701 17.2261C124.151 16.6742 123.378 16.3982 122.393 16.3982C121.292 16.3982 120.413 16.7485 119.778 17.4596C119.132 18.1601 118.814 19.1897 118.814 20.527V30.8543H118.793Z" fill="#022D5B"/>
            <path d="M151.582 31.3427C149.846 31.3427 148.322 30.9712 146.987 30.2282C145.664 29.4853 144.626 28.4451 143.896 27.0865C143.155 25.7386 142.784 24.1571 142.784 22.3421V21.9176C142.784 20.1026 143.144 18.5317 143.875 17.1732C144.605 15.8252 145.622 14.7744 146.935 14.0315C148.247 13.2885 149.761 12.917 151.477 12.917C153.192 12.917 154.611 13.2885 155.87 14.0315C157.141 14.7744 158.126 15.8146 158.824 17.1519C159.523 18.4893 159.883 20.0389 159.883 21.8114V23.2231H146.733C146.776 24.6559 147.273 25.8022 148.216 26.662C149.158 27.5217 150.312 27.9463 151.699 27.9463C153.086 27.9463 154.028 27.6491 154.685 27.0653C155.341 26.4815 155.849 25.8129 156.199 25.0593L159.364 26.6832C159.036 27.3413 158.56 28.0312 157.935 28.7423C157.31 29.464 156.495 30.069 155.468 30.5785C154.441 31.088 153.149 31.3321 151.582 31.3321V31.3427ZM146.755 20.3043H155.934C155.839 19.0837 155.394 18.1178 154.579 17.4173C153.774 16.7168 152.715 16.3559 151.434 16.3559C150.153 16.3559 149.063 16.7061 148.247 17.4173C147.443 18.1178 146.945 19.0837 146.755 20.3043Z" fill="#022D5B"/>
            <path d="M169.835 31.3426C168.406 31.3426 167.083 30.9924 165.876 30.3025C164.669 29.6126 163.695 28.5936 162.953 27.2563C162.212 25.9189 161.842 24.3056 161.842 22.427V21.8963C161.842 20.0176 162.202 18.4043 162.932 17.067C163.663 15.7296 164.637 14.7001 165.854 13.9995C167.072 13.299 168.396 12.9382 169.825 12.9382C170.926 12.9382 171.858 13.0761 172.599 13.3415C173.351 13.6068 173.965 13.9571 174.441 14.3816C174.917 14.8062 175.277 15.2414 175.51 15.6872H176.103V6.1665H179.968V30.8438H176.167V28.4769H175.574C175.15 29.2092 174.505 29.8673 173.626 30.4511C172.747 31.0348 171.477 31.332 169.814 31.332L169.835 31.3426ZM170.958 27.9568C172.461 27.9568 173.7 27.4686 174.685 26.4921C175.669 25.5156 176.167 24.1252 176.167 22.3102V21.96C176.167 20.145 175.68 18.7652 174.706 17.7993C173.732 16.8335 172.482 16.3558 170.958 16.3558C169.433 16.3558 168.216 16.8335 167.231 17.7993C166.246 18.7652 165.749 20.145 165.749 21.96V22.3102C165.749 24.1252 166.246 25.5156 167.231 26.4921C168.216 27.4686 169.454 27.9568 170.958 27.9568Z" fill="#022D5B"/>
        </g>
    </svg>
</div>

<div class="navbar">Admin Management Portal</div>

<div class="container">
    <div class="card">
        <h3>Create Account</h3>
        <div class="input-group">
            <input type="text" id="nameInput" placeholder="Full Name">
            <input type="text" id="phoneInput" placeholder="Phone Number">
            <button onclick="createEmployee()">Add Employee</button>
        </div>
    </div>

    <div class="card">
        <h3>Employee Directory</h3>
        
        <div class="input-group" style="margin-bottom: 20px;">
            <input type="text" id="searchInput" placeholder="üîç Search name or phone..." onkeyup="filterEmployees()">
        </div>

        <div id="loader" style="text-align: center; padding: 20px;">Syncing...</div>
        
        <div class="table-wrapper">
            <table id="employeeTable" style="display: none;">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
        
        <button class="logout-btn" onclick="logout()">Secure Logout</button>
    </div>
</div>

<script>
    const API_BASE = "https://employee-policy-system.onrender.com/api/admin";
    const token = localStorage.getItem("adminToken");

    if (!token) window.location.href = "index.html";

    // üîπ Search Filter Function
    function filterEmployees() {
        const input = document.getElementById("searchInput");
        const filter = input.value.toLowerCase();
        const tbody = document.getElementById("tableBody");
        const tr = tbody.getElementsByTagName("tr");

        for (let i = 0; i < tr.length; i++) {
            const nameCell = tr[i].getElementsByTagName("td")[0];
            const phoneCell = tr[i].getElementsByTagName("td")[1];
            
            if (nameCell || phoneCell) {
                const nameText = nameCell.textContent || nameCell.innerText;
                const phoneText = phoneCell.textContent || phoneCell.innerText;
                
                if (nameText.toLowerCase().indexOf(filter) > -1 || phoneText.indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
    }

    async function fetchEmployees() {
        const loader = document.getElementById("loader");
        const table = document.getElementById("employeeTable");
        const tbody = document.getElementById("tableBody");

        try {
            const res = await fetch(`${API_BASE}/employees`, {
                method: 'GET',
                headers: { 
                    "Authorization": token,
                    "Content-Type": "application/json"
                }
            });

            if (res.status === 401 || res.status === 403) {
                logout();
                return;
            }

            const data = await res.json();
            const employees = data.employees || [];

            tbody.innerHTML = "";
            loader.style.display = "none";
            table.style.display = "table";

            employees.forEach(emp => {
                let statusClass = 'pending';
                let statusLabel = '‚óã Pending';

                if (emp.hasSignedPolicy) {
                    if (emp.policyStatus === 'agreed') {
                        statusClass = 'signed';
                        statusLabel = '‚óè Agreed';
                    } else if (emp.policyStatus === 'disagreed') {
                        statusClass = 'disagreed';
                        statusLabel = '‚óè Disagreed';
                    } else {
                        statusClass = 'signed';
                        statusLabel = '‚óè Signed';
                    }
                }

                const row = `
                    <tr>
                        <td><strong>${emp.name}</strong></td>
                        <td>${emp.phone}</td>
                        <td>
                            <span class="status-badge ${statusClass}">
                                ${statusLabel}
                            </span>
                        </td>
                        <td>
                            <button class="btn-delete" onclick="deleteEmployee('${emp._id}')">Delete</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            if (employees.length === 0) {
                loader.style.display = "block";
                loader.innerText = "No employees found.";
                table.style.display = "none";
            }

        } catch (err) {
            loader.innerText = "Connection Error: Backend is unreachable.";
        }
    }

    async function createEmployee() {
        const name = document.getElementById("nameInput").value;
        const phone = document.getElementById("phoneInput").value;
        if (!name || !phone) return alert("Please fill all fields");

        try {
            const res = await fetch(`${API_BASE}/create-employee`, {
                method: "POST",
                headers: { 
                    "Content-Type": "application/json",
                    "Authorization": token 
                },
                body: JSON.stringify({ name, phone })
            });

            if (res.ok) {
                document.getElementById("nameInput").value = "";
                document.getElementById("phoneInput").value = "";
                fetchEmployees();
            } else {
                const result = await res.json();
                alert(result.message);
            }
        } catch (err) {
            alert("System error.");
        }
    }

    async function deleteEmployee(id) {
        if (!confirm("Delete permanently?")) return;
        try {
            const res = await fetch(`${API_BASE}/delete-employee/${id}`, {
                method: "DELETE",
                headers: { "Authorization": token }
            });
            fetchEmployees();
        } catch (err) {
            alert("Could not delete.");
        }
    }

    function logout() {
        localStorage.removeItem("adminToken");
        window.location.href = "index.html";
    }

    fetchEmployees();
</script>

</body>
</html>