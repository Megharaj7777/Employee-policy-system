<!DOCTYPE html>
<html>
<head>
  <title>Employee Policy System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { margin: 0; font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; justify-content: center; align-items: center; height: 100vh; }
    .container { background: white; padding: 40px; border-radius: 15px; width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); text-align: center; position: relative; }
    h2 { color: #333; margin-bottom: 20px; }
    input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; outline: none; }
    input:focus { border-color: #667eea; }
    button { width: 100%; padding: 12px; border: none; border-radius: 8px; background: #667eea; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
    button:hover { background: #5a67d8; }
    button:disabled { background: #cbd5e0; cursor: not-allowed; }
    .toggle-btn { background: transparent; color: #667eea; margin-top: 15px; font-size: 14px; border: none; cursor: pointer; text-decoration: underline; }
    .hidden { display: none; }
    
    #timerContainer { 
      background: #f7fafc; 
      padding: 8px; 
      border-radius: 8px; 
      margin: 10px 0; 
      display: none;
    }
    #timerText { color: #4a5568; font-size: 14px; font-weight: bold; margin: 0; }
    #seconds { color: #e53e3e; }

    .logo-header {
      position: absolute;
      top: 20px;
      left: 20px;
      background: white;
      padding: 10px 15px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .logo-header svg { width: 140px; height: auto; }

    @media (max-width: 600px) {
        .logo-header { top: 10px; left: 10px; padding: 8px 12px; }
        .logo-header svg { width: 110px; }
    }
  </style>
</head>
<body>

<div class="logo-header">
    <svg width="180" height="37" viewBox="0 0 180 37" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g>
            <path d="M0 15.2309V0.626219C0 0.275961 0.275278 0 0.624669 0H8.036C10.8841 0 13.1922 2.31383 13.1922 5.16896V15.2309C13.1922 15.5812 12.9169 15.8571 12.5675 15.8571H0.624669C0.275278 15.8571 0 15.5812 0 15.2309Z" fill="#B71530"/>
            <path d="M0 21.7693V36.374C0 36.7242 0.275278 37.0002 0.624669 37.0002H8.036C10.8841 37.0002 13.1922 34.6864 13.1922 31.8312V21.7693C13.1922 21.419 12.9169 21.1431 12.5675 21.1431H0.624669C0.275278 21.1431 0 21.419 0 21.7693Z" fill="#B71530"/>
            <path d="M31.7097 15.2309V0.626219C31.7097 0.275961 31.4345 0 31.0851 0H23.6737C20.8257 0 18.5176 2.31383 18.5176 5.16896V15.2309C18.5176 15.5812 18.7929 15.8571 19.1422 15.8571H31.0851C31.4345 15.8571 31.7097 15.5812 31.7097 15.2309Z" fill="#B71530"/>
            <path d="M31.7097 21.7693V36.374C31.7097 36.7242 31.4345 37.0002 31.0851 37.0002H23.6737C20.8257 37.0002 18.5176 34.6864 18.5176 31.8312V21.7693C13.1922 21.419 12.9169 21.1431 12.5675 21.1431H0.624669C0.275278 21.1431 0 21.419 0 21.7693Z" fill="#B71530"/>
            <path d="M48.1734 30.8544H44.1289V6.1665H48.1734V16.6424H58.1575V6.1665H62.202V30.8438H58.1575V20.3042H48.1734V30.8438V30.8544Z" fill="#022D5B"/>
        </g>
    </svg>
</div>

<div class="container">
  <div id="employeeSection">
    <h2>Employee Login</h2>
    <input type="text" id="phone" placeholder="Enter Mobile Number">
    <button id="otpBtn" onclick="sendOTP()">Send OTP</button>

    <div id="timerContainer">
      <p id="timerText">Resend OTP available in <span id="seconds">60</span>s</p>
    </div>

    <input type="text" id="otp" placeholder="Enter OTP" style="margin-top: 15px;">
    <button onclick="verifyOTP()">Verify OTP</button>

    <button class="toggle-btn" onclick="showAdmin()">Login as Admin</button>
  </div>

  <div id="adminSection" class="hidden">
    <h2>Admin Login</h2>
    <input type="text" id="adminUsername" placeholder="Admin Username">
    <input type="password" id="adminPassword" placeholder="Admin Password">
    <button id="adminLoginBtn" onclick="adminLogin()">Login</button>
    <p id="adminError" style="color:red; font-size: 14px; min-height: 20px;"></p>
    <button class="toggle-btn" onclick="showEmployee()">Back to Employee Login</button>
  </div>
</div>

<script>
let savedPhone = "";
let countdown;
const API_URL = "https://employee-policy-system.onrender.com/api";

function showAdmin() {
    document.getElementById("employeeSection").classList.add("hidden");
    document.getElementById("adminSection").classList.remove("hidden");
    document.getElementById("adminError").innerText = "";
}

function showEmployee() {
    document.getElementById("adminSection").classList.add("hidden");
    document.getElementById("employeeSection").classList.remove("hidden");
}

function startTimer() {
    const btn = document.getElementById("otpBtn");
    const container = document.getElementById("timerContainer");
    const secondsSpan = document.getElementById("seconds");
    let timeLeft = 60;

    btn.disabled = true;
    container.style.display = "block";
    secondsSpan.innerText = timeLeft;

    clearInterval(countdown);
    countdown = setInterval(() => {
        timeLeft--;
        secondsSpan.innerText = timeLeft;

        if (timeLeft <= 0) {
            clearInterval(countdown);
            btn.disabled = false;
            container.style.display = "none";
        }
    }, 1000);
}

async function sendOTP() {
    let phoneInput = document.getElementById("phone").value.replace(/\D/g, "");
    if (phoneInput.length < 10) return alert("Enter valid 10-digit number");

    savedPhone = phoneInput.slice(-10);

    try {
        const res = await fetch(`${API_URL}/employee/send-otp`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ phone: savedPhone })
        });
        const data = await res.json();
        if (res.ok) {
            alert("OTP Sent Successfully");
            startTimer();
        } else {
            alert(data.message || "Failed to send OTP");
        }
    } catch (err) {
        alert("Server error connecting to backend");
    }
}

async function verifyOTP() {
    const otp = document.getElementById("otp").value.trim();
    if (!otp) return alert("Enter OTP");
    if (!savedPhone) return alert("Request OTP first");

    try {
        const res = await fetch(`${API_URL}/employee/verify-otp`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ phone: savedPhone, otp })
        });
        const data = await res.json();
        if (res.ok && data.token) {
            localStorage.setItem("employeeToken", data.token);
            alert("Login successful");
            window.location.href = "policy.html";
        } else {
            alert(data.message || "Invalid OTP");
        }
    } catch (err) {
        alert("Verification failed");
    }
}

async function adminLogin() {
    const username = document.getElementById("adminUsername").value.trim();
    const password = document.getElementById("adminPassword").value.trim();
    const errorEl = document.getElementById("adminError");
    const loginBtn = document.getElementById("adminLoginBtn");

    if (!username || !password) {
        errorEl.innerText = "Enter username and password";
        return;
    }

    loginBtn.disabled = true;
    loginBtn.innerText = "Authenticating...";

    try {
        const res = await fetch(`${API_URL}/admin/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password })
        });

        const data = await res.json();

        if (res.ok && data.token) {
            localStorage.setItem("adminToken", data.token);
            alert("Admin login successful");
            // FIXED REDIRECT FILENAME:
            window.location.href = "admin-dashboard.html"; 
        } else {
            errorEl.innerText = data.message || "Invalid credentials";
            loginBtn.disabled = false;
            loginBtn.innerText = "Login";
        }
    } catch (err) {
        errorEl.innerText = "Server error. Backend might be waking up.";
        loginBtn.disabled = false;
        loginBtn.innerText = "Login";
    }
}
</script>

</body>
</html>