<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Policy Agreement</title>
  <style>
    body { font-family: sans-serif; background: #f4f7f6; display: flex; justify-content: center; padding-top: 50px; }
    .card { background: white; padding: 30px; border-radius: 12px; width: 400px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; }
    .status-msg { background: #e6fffa; color: #2c7a7b; padding: 10px; border-radius: 8px; margin-bottom: 10px; display: none; font-weight: bold; }
    .radio-group { margin: 20px 0; display: flex; justify-content: space-around; }
    button { width: 100%; padding: 10px; border: none; border-radius: 8px; background: #667eea; color: white; cursor: pointer; margin-top: 10px; }
    .btn-logout { background: #cbd5e0; color: #4a5568; }
  </style>
</head>
<body>
<div class="card">
  <h2>Company Policy</h2>
  <div id="statusMsg" class="status-msg">âœ“ Policy already signed</div>
  <p id="instr">Please review and select an option:</p>
  <div class="radio-group">
    <label><input type="radio" name="policy" value="agreed"> Agree</label>
    <label><input type="radio" name="policy" value="disagreed"> Disagree</label>
  </div>
  <button id="submitBtn" onclick="submitPolicy()">Submit</button>
  <button class="btn-logout" onclick="logout()">Logout</button>
</div>

<script>
  const token = localStorage.getItem("employeeToken");
  if (!token) window.location.href = "index.html";

  async function checkStatus() {
    const res = await fetch("https://employee-policy-system.onrender.com/api/employee/me", {
      headers: { "Authorization": token }
    });
    const data = await res.json();
    if (data.user && data.user.hasSignedPolicy) {
      document.getElementById("submitBtn").style.display = "none";
      document.getElementById("statusMsg").style.display = "block";
      document.getElementById("instr").innerText = "Your recorded response:";
      const radios = document.getElementsByName("policy");
      radios.forEach(r => {
        if (r.value === data.user.policyStatus) r.checked = true;
        r.disabled = true;
      });
    }
  }

  async function submitPolicy() {
    const selected = document.querySelector('input[name="policy"]:checked');
    if (!selected) return alert("Select an option");
    const res = await fetch("https://employee-policy-system.onrender.com/api/employee/submit-policy", {
      method: "POST",
      headers: { "Content-Type": "application/json", "Authorization": token },
      body: JSON.stringify({ status: selected.value })
    });
    if (res.ok) window.location.href = "success.html";
  }

  function logout() { localStorage.removeItem("employeeToken"); window.location.href = "index.html"; }
  checkStatus();
</script>
</body>
</html>